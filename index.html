<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Bob's Building Heart</title>
    <style>
        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: #ffe6f2;
            position: relative;
        }
        .bob-container {
            width: 100px;  /* Made Bob smaller */
            height: 100px;
            position: absolute;
            transition: all 0.3s ease;
            z-index: 2;
            pointer-events: none; /* Prevents Bob from interfering with interactions */
        }
        .bob-gif {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        #heartCanvas {
            border: 2px solid #ffb3d9;
            border-radius: 10px;
            background: white;
            position: relative;
        }
        .message {
            position: absolute;
            top: 20px;
            text-align: center;
            width: 100%;
            font-family: 'Arial', sans-serif;
            color: #ff4d94;
            font-size: 24px;
        }
        .canvas-container {
            position: relative;
            width: 400px;
            height: 400px;
        }
    </style>
</head>
<body>
    <div class="message">Building Love, Just For You! ❤️</div>
    <div class="container">
        <div class="canvas-container">
              <div class="bob-container" id="bobContainer">
                <img src="./bob-the-builder.gif" alt="Bob the Builder" class="bob-gif" id="bobGif">
            </div>
            <canvas id="heartCanvas" width="400" height="400"></canvas>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('heartCanvas');
        const ctx = canvas.getContext('2d');
        const bobContainer = document.getElementById('bobContainer');
        const canvasContainer = document.querySelector('.canvas-container');
        
        // LEGO brick properties
        const brickWidth = 20;
        const brickHeight = 10;
        const brickColors = ['#ff6b6b', '#ff8585', '#ff9999', '#ff4d4d'];
        
        function moveBobToBrick(brick) {
        // Calculate position relative to canvas container
            const x = brick.x - 50; // Center Bob (half of Bob's width)
            const y = brick.y - 50; // Center Bob (half of Bob's height)
    
        // Ensure Bob doesn't go too far off-screen
            bobContainer.style.transform = `translate(${x}px, ${y}px)`;
            }    
    

        class Brick {
            constructor(x, y, row) {
                this.x = x;
                this.y = y;
                this.row = row;
                this.color = brickColors[Math.floor(Math.random() * brickColors.length)];
                this.scale = 0;
                this.built = false;
            }
            
            draw() {
                if (this.scale < 1) {
                    this.scale += 0.1;
                }
                
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.scale(this.scale, this.scale);
                
                // Main brick body
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.roundRect(-brickWidth/2, -brickHeight/2, brickWidth, brickHeight, 2);
                ctx.fill();
                
                // Brick studs
                ctx.fillStyle = '#ff3333';
                ctx.beginPath();
                ctx.arc(-5, -brickHeight/2, 2, 0, Math.PI * 2);
                ctx.arc(5, -brickHeight/2, 2, 0, Math.PI * 2);
                ctx.fill();
                
                // Brick shadow
                ctx.fillStyle = 'rgba(0,0,0,0.1)';
                ctx.fillRect(-brickWidth/2, brickHeight/3, brickWidth, brickHeight/6);
                
                ctx.restore();
            }
        }

        // Create heart shape
        function isInHeart(x, y) {
            const nx = (x - canvas.width/2) / 100;
            const ny = -(y - canvas.height/2) / 100;
            const heart = Math.pow(Math.pow(nx, 2) + Math.pow(ny - Math.sqrt(Math.abs(nx)), 2), 0.5);
            return heart <= 1.3;
        }

        // Create bricks array
        const bricks = [];
        for (let row = 0; row < canvas.height; row += brickHeight) {
            for (let col = 0; col < canvas.width; col += brickWidth) {
                if (isInHeart(col, row)) {
                    bricks.push(new Brick(col, row, row));
                }
            }
        }
        
        // Sort bricks from bottom to top
        bricks.sort((a, b) => b.row - a.row);
        
        // Animation variables
        let currentBrick = 0;
        let buildDelay = 50;
        let lastBuildTime = 0;

        // Animation loop
        function animate(timestamp) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Build new brick if enough time has passed
            if (timestamp - lastBuildTime > buildDelay && currentBrick < bricks.length) {
                bricks[currentBrick].built = true;
                
                // Move Bob to current brick position
                moveBobToBrick(bricks[currentBrick]);
                
                currentBrick++;
                lastBuildTime = timestamp;
            }
            
            // Draw built bricks
            for (let i = 0; i < currentBrick; i++) {
                bricks[i].draw();
            }
            
            // Sparkle effect at current building position
            if (currentBrick > 0 && currentBrick < bricks.length) {
                drawSparkle(bricks[currentBrick-1].x, bricks[currentBrick-1].y, timestamp);
            }
            
            // Celebration effects when complete
            if (currentBrick === bricks.length) {
                drawLoveParticles(timestamp);
                // Move Bob to final center position
                moveBobToBrick({x: canvas.width/2, y: canvas.height - 50});
            }
            
            requestAnimationFrame(animate);
        }
        
        // Sparkle effect
        function drawSparkle(x, y, timestamp) {
            const sparkleSize = 2 + Math.sin(timestamp/200) * 1;
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.arc(x, y, sparkleSize, 0, Math.PI * 2);
            ctx.fill();
        }
        
        // Love particles effect
        const particles = [];
        function drawLoveParticles(timestamp) {
            if (Math.random() < 0.1) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: canvas.height,
                    speed: 1 + Math.random() * 2,
                    size: 2 + Math.random() * 3
                });
            }
            
            ctx.fillStyle = '#ffccd5';
            particles.forEach((particle, index) => {
                particle.y -= particle.speed;
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                ctx.fill();
                
                if (particle.y < 0) particles.splice(index, 1);
            });
        }

        // Start animation when page loads
        window.addEventListener('load', () => {
            // Position Bob at starting position (bottom center)
            moveBobToBrick({x: canvas.width/2, y: canvas.height + 25});
            // Start animation
            animate(0);
        });
    </script>
</body>
</html>
